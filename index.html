<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>筋トレ管理アプリケーション</title>
<link rel="stylesheet" href="styles.css">
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(drawChart);

  function drawChart() {
    fetch('https://script.google.com/macros/s/AKfycbx3gcjd_BFHzEjj2wA5oGbCEbS5EgqNlEAMnZmgt6diC7FHNzLU_m9tzCQBHq1sjy0D/exec')
      .then(response => response.json())
      .then(data => {
        var formattedData = [['種類', '重さ (kg)', '回数']];
        data.forEach(item => {
          formattedData.push([item['種類'], parseInt(item['重さ']), parseInt(item['回数'])]);
        });

        var dataTable = google.visualization.arrayToDataTable(formattedData);

        var options = {
          title: '筋トレ記録',
          hAxis: {title: '種類'},
          vAxis: {title: '値'}
        };

        var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
        chart.draw(dataTable, options);
      })
      .catch(error => console.error('エラーが発生しました:', error));
  }
</script>
</head>
<body>

<div class="container">
  <h2>筋トレ記録</h2>
  <form id="workoutForm">
    <label for="exerciseType">種類:</label><br>
    <input type="text" id="exerciseType" name="type" required><br><br>
    
    <label for="weight">重さ (kg):</label><br>
    <select id="weight" name="weight" required>
      <option value="5">5 kg</option>
      <option value="10">10 kg</option>
      <option value="15">15 kg</option>
      <option value="20">20 kg</option>
      <option value="25">25 kg</option>
      <option value="30">30 kg</option>
      <option value="35">35 kg</option>
      <option value="40">40 kg</option>
      <option value="45">45 kg</option>
      <option value="50">50 kg</option>
      <option value="55">55 kg</option>
      <option value="60">60 kg</option>
      <option value="65">65 kg</option>
      <option value="70">70 kg</option>
      <option value="75">75 kg</option>
      <option value="80">80 kg</option>
      <option value="85">85 kg</option>
      <option value="90">90 kg</option>
      <option value="95">95 kg</option>
      <option value="100">100 kg</option>
    </select><br><br>
    
    <label for="reps">回数:</label><br>
    <select id="reps" name="reps" required>
      <option value="5">5 回</option>
      <option value="10">10 回</option>
      <option value="15">15 回</option>
      <option value="20">20 回</option>
      <option value="25">25 回</option>
      <option value="30">30 回</option>
      <option value="35">35 回</option>
      <option value="40">40 回</option>
      <option value="45">45 回</option>
      <option value="50">50 回</option>
    </select><br><br>
    
    <label for="date">やった日にち:</label><br>
    <input type="date" id="date" name="date" required><br><br>
    
    <button type="submit">記録する</button>
  </form>
  
  <div id="chart_div" style="width: 100%; height: 500px;"></div>
  <div id="records">
    <!-- ここに記録されたデータが表示される -->
  </div>
  <div id="response"></div>
</div>

<script>
document.getElementById('workoutForm').addEventListener('submit', function(e) {
  e.preventDefault();
  
  // メッセージエリアをクリア
  document.getElementById('response').innerText = '';
  
  var date = document.getElementById('date').value;
  var weight = document.getElementById('weight').value;
  var reps = document.getElementById('reps').value;
  var type = document.getElementById('exerciseType').value;
  
  var formData = new FormData();
  formData.append('date', date);
  formData.append('weight', weight);
  formData.append('reps', reps);
  formData.append('type', type);
  
  // Google Apps ScriptのウェブアプリURLを指定します
  fetch('https://script.google.com/macros/s/AKfycbx3gcjd_BFHzEjj2wA5oGbCEbS5EgqNlEAMnZmgt6diC7FHNzLU_m9tzCQBHq1sjy0D/exec', {
    method: 'POST',
    body: formData
  })
  .then(response => response.json())
  .then(data => {
    if (data.result === "success") {
      document.getElementById('response').innerText = "データが正常に送信されました。";
    } else {
      document.getElementById('response').innerText = "エラーが発生しました: " + data.message;
    }
  })
  .catch(error => {
    document.getElementById('response').innerText = 'エラーが発生しました: ' + error.message;
  });
});

function displayRecord(record) {
  var recordsDiv = document.getElementById('records');
  var recordHTML = `
    <div>
      <strong>種類:</strong> ${record.type}<br>
      <strong>重さ:</strong> ${record.weight} kg<br>
      <strong>回数:</strong> ${record.reps} 回<br>
      <strong>やった日にち:</strong> ${record.date}<br>
      <hr>
    </div>
  `;
  
  recordsDiv.insertAdjacentHTML('afterbegin', recordHTML);
}
</script>

</body>
</html>
